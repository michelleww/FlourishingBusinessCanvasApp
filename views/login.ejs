<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Flourishing Business Canvas</title>
  <link href='https://fonts.googleapis.com/css?family=Titillium+Web:400,300,600' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
  <link rel="stylesheet" href="css/login.css">
</head>

<body>
  <div class="form">
    <ul class="tab-group">
      <li class="tab active"><a href="#login">Log In</a></li>
      <li class="tab"><a href="#signup">Sign Up</a></li>
    </ul>

    <div class="tab-content">

      <div id="login">
        <h1 id="log-error">Welcome Back!</h1>

        <form role="form" action="/" method="">

          <div class="field-wrap">
            <label>
              Email Address<span class="req">*</span>
            </label>
            <input class="log-email" type="email" name="log_email" required autocomplete="off" />
          </div>

          <div class="field-wrap">
            <label>
              Password<span class="req">*</span>
            </label>
            <input class="log-pwd" type="password" name="log_pwd" required autocomplete="off" />
          </div>
        </form>
        <button class="button button-block" id="login_submit" />Log In</button>

      </div>

      <div id="signup">
        <h1 id="req-error">Sign Up for Free</h1>

        <form role="form">

          <div class="field-wrap">
            <label>
              First Name<span class="req">*</span>
            </label>
            <input class="req-fname" type="text" name="reg_name" required autocomplete="off" />
          </div>

          <div class="field-wrap">
            <label>
              Last Name<span class="req">*</span>
            </label>
            <input class="req-lname" type="text" name="reg_name" required autocomplete="off" />
          </div>

          <div class="field-wrap">
            <label>
              Email Address<span class="req">*</span>
            </label>
            <input class="req-email" type="email" name="reg_email" required autocomplete="off" />
          </div>

          <div class="field-wrap">
            <label>
              Set A Password<span class="req">*</span>
            </label>
            <input class="req-pwd" type="password" name="reg_pwd" required autocomplete="off" />
          </div>
        </form>
        <button class="button button-block" id="register_submit" />Get Started</button>
      </div>
    </div><!-- tab-content -->

  </div> <!-- /form -->
  <div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <p id="content">Some text in the Modal..</p>
    </div>
  
  </div>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
  <script src="https://smtpjs.com/v3/smtp.js"></script>

</body>

</html>

<script type="text/javascript">

// Get the modal
var modal = document.getElementById('myModal');
var modalContent = document.getElementById('content');
// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}

$('.form').find('input, textarea').on('keyup blur focus', function (e) {

  var $this = $(this),
    label = $this.prev('label');

  if (e.type === 'keyup') {
    if ($this.val() === '') {
      label.removeClass('active highlight');
    } else {
      label.addClass('active highlight');
    }
  } else if (e.type === 'blur') {
    if ($this.val() === '') {
      label.removeClass('active highlight');
    } else {
      label.removeClass('highlight');
    }
  } else if (e.type === 'focus') {

    if ($this.val() === '') {
      label.removeClass('highlight');
    }
    else if ($this.val() !== '') {
      label.addClass('highlight');
    }
  }

});

$('.tab a').on('click', function (e) {

  e.preventDefault();

  $(this).parent().addClass('active');
  $(this).parent().siblings().removeClass('active');

  target = $(this).attr('href');

  $('.tab-content > div').not(target).hide();

  $(target).fadeIn(600);

});



$('#register_submit').on('click', function () {
  // get required information from front end
  var fname = document.getElementsByClassName('req-fname')[0].value.trim();
  var lname = document.getElementsByClassName('req-lname')[0].value.trim();
  var email = document.getElementsByClassName('req-email')[0].value.trim();
  var pwd = document.getElementsByClassName('req-pwd')[0].value.trim();

  // check if the contents are empty and display corresponding error
  if (name == '' || email == '' || pwd == '' || fname == '' || lname == '') {
    modalContent.innerHTML = "Please complete all the fields!";
    modal.style.display = "block";
    document.getElementsByClassName('req-email')[0].value = '';
    document.getElementsByClassName('req-pwd')[0].value = '';
    document.getElementsByClassName('req-lname')[0].value = '';
    document.getElementsByClassName('req-fname')[0].value = '';
  }
  // check email format 
  else if (email.includes('@') == false || email.indexOf('@') == (email.length - 1)) {
    modalContent.innerHTML = "Please  enter a valid email address!";
    modal.style.display = "block";
    document.getElementsByClassName('req-email')[0].value = '';
  }
  // interact with backend
  else {
    var name = fname + '\xa0' + lname;
    var sent = { name, email, pwd };
    $.ajax({
      type: "POST",
      url: "/register",
      data: sent,
      success: function (data) {
        if (data == 'false') {
          modalContent.innerHTML = "Oops, the specified email address has been registered in the system";
          modal.style.display = "block";
          ent.getElementsByClassName('req-email')[0].value = '';
        } else if (data == 2) {
          window.location.href = "/profile";
        } else if (data == 3) {
          window.location.href = "/manager";
        } else if (data == 4) {
          window.location.href = "/admin";
        } else if (data == 1) {
          modalContent.innerHTML = "The notification has been sent to the administrator, please wait for response";
          modal.style.display = "block";
          Email.send({
            Host: "smtp.elasticemail.com",
            Username: "wangluya2014@gmail.com",
            Password: "818b6867-983b-46fb-839b-eb03ecbf5f3c",
            To: 'testingcsc301@mailinator.com',
            From: "wangluya2014@gmail.com",
            Subject: "This is the subject",
            Body: "Testing for register!."
          }).then(message => alert(message))
        }
      }
    });
  }
});

$('#login_submit').on('click', function () {

  // get required information from front end
  var email = document.getElementsByClassName('log-email')[0].value.trim();
  var pwd = document.getElementsByClassName('log-pwd')[0].value.trim();
  // clean up the content in the html
  document.getElementsByClassName('log-email')[0].value = '';
  document.getElementsByClassName('log-pwd')[0].value = '';

  // check if the contents are empty and display corresponding error
  if (email == '' || pwd == '') {
    modalContent.innerHTML = "Please enter email and password to login!";
    modal.style.display = "block";

  } 
  // check email format
  else if (email.includes('@') == false || email.indexOf('@') == (email.length - 1)) {
    modalContent.innerHTML = "Please enter a valid email address!";
    modal.style.display = "block";
  }
   // interact with backend
  else {
    var send = { email, pwd };
    $.ajax({
      type: "POST",
      url: "/login",
      data: send,
      success: function (data) {
        if (data == 'false') {
          modalContent.innerHTML = "Oops, invalid password!";
          modal.style.display = "block";
        } else if (data == 'denied') {
          modalContent.innerHTML = "User does not exist or does not have the authorization to login!";
          modal.style.display = "block";
        } else if (data == "2") {
          window.location.href = "/profile";
        } else if (data == 3) {
          window.location.href = "/manager";
        } else if (data == 4) {
          window.location.href = "/admin";
        }
      }
    });
  }
});
</script>
