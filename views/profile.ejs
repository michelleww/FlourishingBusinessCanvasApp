<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>User Profile</title>
    <link rel="stylesheet" type="text/css" href="/css/profile.css"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
</head>

<body>
    <div class="userInfo">
        <div>
            <div class="detail">
                <div class="form-group row">
                    <label class="col-sm-2 col-form-label">Email:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" disabled="disabled" id="email">
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 col-form-label">First Name:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="firstName">
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 col-form-label">Last Name:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="lastName">
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 col-form-label">Company:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="company">
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 col-form-label">Occupation:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="occupation">
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-sm-2 col-form-label">Phone:</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="phone">
                    </div>
                </div>
            </div>

            <div class="profilePicture">
                <input type="file" accept="image/*" id="upload"/>
            </div>
        </div>

        <br>

        <div class="btnBox">
            <button type="button" class="btn btn-secondary btn-sm" id="save">Save Changes</button>
        </div>

        <div class="changePassword">
            <a href="pwd.ejs">Want to change password?</a>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
    <script type="text/javascript">
        var oldCompany, oldOccupation, oldPhone;

        $('body').ready(function() {
            var email = Cookies.get('email');
            var emailTextBox = document.querySelector('#email')
            emailTextBox.appendChild(document.createTextNode(email))

            var oldName = Cookies.get('name').split(" ");

            var oldFirstName = oldName[0];
            var firstNameTextBox = document.querySelector('#firstName')
            firstNameTextBox.appendChild(document.createTextNode(oldFirstName))

            var oldLastName = oldName[1];
            var lastNameTextBox = document.querySelector('#lastName')
            lastNameTextBox.appendChild(document.createTextNode(oldLastName))

            $.ajax({
                type: "GET",
                url: "/profile/get",
                success: function(data) {
                    oldCompany = data.company;
                    var companyTextBox = document.querySelector('#company')
                    companyTextBox.appendChild(document.createTextNode(oldCompany))

                    oldOccupation = data.occupation;
                    var occupationTextBox = document.querySelector('#occupation')
                    occupationTextBox.appendChild(document.createTextNode(oldOccupation))

                    oldPhone = data.phone;
                    var phoneTextBox = document.querySelector('#phone')
                    phoneTextBox.appendChild(document.createTextNode(oldPhone))
                }
            });
        })

        $('#save').on('click', function() {
            const firstName = document.getElementById("#firstName").value;
            const lastName = document.getElementById("#lastName").value;
            const company = document.getElementById("#company").value;
            const occupation = document.getElementById("#occupation").value;
            const phone = document.getElementById("#phone").value;

            var name = firstName + " " + lastName;
            
            var send = {name, company, occupation, phone};

            $.ajax({
                type: "POST",
                url: "/profile/edit",
                data: send,
                success: function(data) {
                    if (data == 'true') {
                        alert("Successfully changed profile!")
                    } else {
                        alert("Oops! An error occurred. Failed to change profile.")
                    }
                }
            });
        })
    </script>
</body>
</html>